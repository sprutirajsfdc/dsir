<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Notification_when_Under_offer</name>
        <label>Send Notification when Under offer</label>
        <locationX>50</locationX>
        <locationY>839</locationY>
        <actionName>pba__Offer__c.Offer_status_is_Under_Offer_Email_Alert</actionName>
        <actionType>emailAlert</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>pba__Offer__c.Offer_status_is_Under_Offer_Email_Alert</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>59.0</apiVersion>
    <decisions>
        <name>Check_Status</name>
        <label>Check Status</label>
        <locationX>182</locationX>
        <locationY>731</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Under_Offer</name>
            <conditionLogic>(1 AND 2) OR (2 AND 3)</conditionLogic>
            <conditions>
                <leftValueReference>$Record.pba__Status__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.pba__Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Under Offer</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>IsNew_formula</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Notification_when_Under_offer</targetReference>
            </connector>
            <label>Under Offer</label>
        </rules>
    </decisions>
    <decisions>
        <name>Status_is_under_offer_and_Listing_is_Blank</name>
        <label>Status is under offer and Listing is Blank</label>
        <locationX>182</locationX>
        <locationY>323</locationY>
        <defaultConnector>
            <targetReference>Check_Status</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Status_offer_Listing_Blank</name>
            <conditionLogic>(1 AND 2 AND 4 AND (3 OR 6) ) OR (1 AND 2 AND 5 AND (3 OR 6) )</conditionLogic>
            <conditions>
                <leftValueReference>$Record.pba__Status__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Under Offer</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.pba__Listing__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Rent</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.pba__Status__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>IsNew_formula</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.RecordType.DeveloperName</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Sale</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Listing_Records</targetReference>
            </connector>
            <label>Status offer &amp; Listing Blank</label>
        </rules>
    </decisions>
    <description>When Offer is Created and Updated, Record type is Sale or Rent, Status is Under Offer and Listing is Blank then Create a Listing Record and Update that created listing on Same Offer.</description>
    <environments>Default</environments>
    <formulas>
        <name>Area_town_and_city_county_formula</name>
        <dataType>String</dataType>
        <expression>{!$Record.Area_Town__c}+&quot;,&quot;+&quot;&quot;+{!$Record.City_County__c}</expression>
    </formulas>
    <formulas>
        <name>IsNew_formula</name>
        <dataType>Boolean</dataType>
        <expression>ISNEW()</expression>
    </formulas>
    <formulas>
        <name>Offer_Address_80_Char_Formula</name>
        <dataType>String</dataType>
        <expression>LEFT({!$Record.Address__c}, 80)</expression>
    </formulas>
    <formulas>
        <name>RecordTypeId_Formula</name>
        <dataType>String</dataType>
        <expression>IF({!$Record.RecordType.DeveloperName}=&quot;Rent&quot;, &quot;0121t0000008UkJAAU&quot;, IF({!$Record.RecordType.DeveloperName}=&quot;Sale&quot;, &quot;0121t0000008UkIAAU&quot;,&quot;&quot;))</expression>
    </formulas>
    <formulas>
        <name>Street_and_village_formula</name>
        <dataType>String</dataType>
        <expression>{!$Record.Street__c}+&quot;,&quot;+&quot;&quot;+{!$Record.Village__c}</expression>
    </formulas>
    <interviewLabel>Offer After Flow - Creating Listing {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Offer After Flow - when Status Under offer Creating Listing</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Listing_Records</name>
        <label>Listing Records</label>
        <locationX>50</locationX>
        <locationY>431</locationY>
        <connector>
            <targetReference>Updating_Listing_lookup</targetReference>
        </connector>
        <inputAssignments>
            <field>Area_Town_City__c</field>
            <value>
                <elementReference>$Record.Area_Town__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>County__c</field>
            <value>
                <elementReference>$Record.City_County__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>External_Listing__c</field>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Listing_Inquiry_Recipient__c</field>
            <value>
                <elementReference>$Record.OwnerId</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Listing_Sub_Status__c</field>
            <value>
                <stringValue>Under Offer - Unavailable</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Marketing_Exposure__c</field>
            <value>
                <stringValue>UK SIR Website</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Name</field>
            <value>
                <elementReference>Offer_Address_80_Char_Formula</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>OwnerId</field>
            <value>
                <stringValue>0051t000001AA5pAAG</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>PropertyOwnerContact__c</field>
            <value>
                <elementReference>$Record.Seller__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>RecordTypeId_Formula</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>UKPostal_Code__c</field>
            <value>
                <elementReference>$Record.Postcode__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Village__c</field>
            <value>
                <elementReference>$Record.Village__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>gsir_listing_category__c</field>
            <value>
                <stringValue>Primary</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>gsir_mandate__c</field>
            <value>
                <stringValue>Non Exclusive</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba__Address_pb__c</field>
            <value>
                <elementReference>$Record.Address__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba__Bedrooms_pb__c</field>
            <value>
                <numberValue>2.0</numberValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba__Country_pb__c</field>
            <value>
                <elementReference>$Record.Country__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba__Description_pb__c</field>
            <value>
                <stringValue>This listing is generated from an offer that cannot be modified</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba__ListingPrice_pb__c</field>
            <value>
                <elementReference>$Record.pba__OfferedAmount_pb__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba__Status__c</field>
            <value>
                <stringValue>Draft</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba__Street_pb__c</field>
            <value>
                <elementReference>$Record.Street__c</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba_uaefields__Community_Propertyfinder__c</field>
            <value>
                <elementReference>Area_town_and_city_county_formula</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba_uaefields__Completion_Status__c</field>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba_uaefields__Property_Sub_Type__c</field>
            <value>
                <stringValue>Residential - Apartment</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>pba_uaefields__Sub_Community_Propertyfinder__c</field>
            <value>
                <elementReference>Street_and_village_formula</elementReference>
            </value>
        </inputAssignments>
        <object>pba__Listing__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordUpdates>
        <name>Updating_Listing_lookup</name>
        <label>Updating Listing lookup</label>
        <locationX>50</locationX>
        <locationY>539</locationY>
        <connector>
            <targetReference>Check_Status</targetReference>
        </connector>
        <inputAssignments>
            <field>pba__Listing__c</field>
            <value>
                <elementReference>Listing_Records</elementReference>
            </value>
        </inputAssignments>
        <inputReference>$Record</inputReference>
    </recordUpdates>
    <start>
        <locationX>56</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Status_is_under_offer_and_Listing_is_Blank</targetReference>
        </connector>
        <object>pba__Offer__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
